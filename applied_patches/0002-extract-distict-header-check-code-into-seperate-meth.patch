From be973ca34dab5a6bcc9ab3aa9fa25f64d9b4b64c Mon Sep 17 00:00:00 2001
From: Jens Rehsack <sno@NetBSD.org>
Date: Sun, 8 Jan 2012 12:42:11 +0100
Subject: [PATCH 2/4] extract distict header check code into seperate method
 to allow complex checks as check_dirent_header or
 check_resolv_header

---
 lib/Config/AutoConf.pm |   28 +++++++++++++++++++---------
 1 files changed, 19 insertions(+), 9 deletions(-)

diff --git a/lib/Config/AutoConf.pm b/lib/Config/AutoConf.pm
index 48944dc..6b26689 100644
--- a/lib/Config/AutoConf.pm
+++ b/lib/Config/AutoConf.pm
@@ -1087,6 +1087,19 @@ sub _have_header_define_name {
   return $have_name;
 }
 
+sub _check_header {
+  my ($self, $header, $prologue, $body) = @_;
+
+  $prologue .= <<"_ACEOF";
+    #include <$header>
+_ACEOF
+  my $conftest = $self->lang_build_program( $prologue, $body );
+
+  my $have_header = $self->compile_if_else( $conftest );
+  return $have_header;
+}
+
+
 =head2 check_header
 
 This function is used to check if a specific header file is present in
@@ -1108,19 +1121,16 @@ sub check_header {
   my $header = shift;
   my $pre_inc = shift;
   
+
   return 0 unless $header;
+  my $prologue  = "";
+  defined $pre_inc
+    and $prologue .= "$pre_inc\n";
+
   my $cache_name = $self->_cache_name( $header );
   my $check_sub = sub {
   
-    my $prologue  = "";
-    defined $pre_inc
-      and $prologue .= "$pre_inc\n";
-       $prologue .= <<"_ACEOF";
-    #include <$header>
-_ACEOF
-    my $conftest = $self->lang_build_program( $prologue, "" );
-
-    my $have_header = $self->compile_if_else( $conftest );
+    my $have_header = $self->_check_header( $header, $prologue, "" );
     $self->define_var( _have_header_define_name( $header ), $have_header ? $have_header : undef, "defined when $header is available" );
 
     return $have_header;
-- 
1.7.7.2

